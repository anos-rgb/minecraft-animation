DOCTYP<!E html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Animation Editor Pro</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6200ea;
            --primary-light: #bb86fc;
            --primary-dark: #3700b3;
            --secondary: #03dac6;
            --secondary-light: #66fff9;
            --secondary-dark: #00bfa5;
            --background: #121212;
            --surface: #1e1e1e;
            --surface-variant: #2c2c2c;
            --error: #cf6679;
            --on-primary: #ffffff;
            --on-secondary: #000000;
            --on-background: #ffffff;
            --on-surface: #ffffff;
            --outline: #3e3e3e;
            --success: #4caf50;
            --warning: #ff9800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background);
            color: var(--on-background);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .app-header {
            background-color: var(--surface);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 100;
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 500;
        }

        .app-title .material-icons {
            color: var(--primary);
            font-size: 1.8rem;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .header-btn {
            background-color: var(--primary);
            color: var(--on-primary);
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: 500;
        }

        .header-btn:hover {
            background-color: var(--primary-dark);
        }

        .header-btn.secondary {
            background-color: var(--surface-variant);
        }

        .header-btn.secondary:hover {
            background-color: var(--outline);
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 320px;
            background-color: var(--surface);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            box-shadow: 2px 0 4px rgba(0,0,0,0.2);
        }

        .viewer-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .viewer-toolbar {
            background-color: var(--surface);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .viewer-options {
            display: flex;
            gap: 12px;
        }

        .viewer-btn {
            background: none;
            border: none;
            color: var(--on-surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .viewer-btn:hover {
            background-color: var(--surface-variant);
        }

        .viewer-btn.active {
            background-color: var(--primary);
            color: var(--on-primary);
        }

        .canvas-container {
            flex: 1;
            position: relative;
            background-color: #0a0a0a;
            overflow: hidden;
        }

        #canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .timeline-container {
            height: 200px;
            background-color: var(--surface);
            border-top: 1px solid var(--outline);
            display: flex;
            flex-direction: column;
        }

        .timeline-header {
            padding: 8px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--outline);
        }

        .timeline-title {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .timeline-controls {
            display: flex;
            gap: 8px;
        }

        .timeline-btn {
            background: none;
            border: none;
            color: var(--on-surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .timeline-btn:hover {
            background-color: var(--surface-variant);
        }

        .timeline-btn.active {
            background-color: var(--primary);
            color: var(--on-primary);
        }

        .timeline-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .timeline-tracks {
            height: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            position: relative;
        }

        .timeline-track {
            height: 40px;
            border-bottom: 1px solid var(--outline);
            position: relative;
        }

        .timeline-track-header {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 120px;
            background-color: var(--surface-variant);
            display: flex;
            align-items: center;
            padding: 0 12px;
            font-size: 0.875rem;
            z-index: 2;
            border-right: 1px solid var(--outline);
        }

        .timeline-track-content {
            margin-left: 120px;
            height: 100%;
            position: relative;
        }

        .timeline-keyframe {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 1;
        }

        .timeline-keyframe:hover {
            background-color: var(--primary-light);
            width: 14px;
            height: 14px;
        }

        .timeline-playhead {
            position: absolute;
            top: 0;
            width: 2px;
            height: 100%;
            background-color: var(--error);
            z-index: 3;
            pointer-events: none;
        }

        .sidebar-section {
            padding: 16px;
            border-bottom: 1px solid var(--outline);
        }

        .section-title {
            font-weight: 500;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title .material-icons {
            color: var(--primary);
        }

        .control-group {
            margin-bottom: 16px;
        }

        .control-label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.875rem;
            color: var(--on-surface);
        }

        .control-input {
            width: 100%;
            padding: 8px 12px;
            background-color: var(--surface-variant);
            border: 1px solid var(--outline);
            border-radius: 4px;
            color: var(--on-surface);
            font-family: 'Roboto', sans-serif;
        }

        .control-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .slider {
            flex: 1;
            height: 4px;
            background-color: var(--surface-variant);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background-color: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background-color: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .slider-value {
            min-width: 40px;
            text-align: right;
            font-size: 0.875rem;
        }

        .control-row {
            display: flex;
            gap: 12px;
        }

        .control-col {
            flex: 1;
        }

        .btn {
            padding: 8px 16px;
            background-color: var(--primary);
            color: var(--on-primary);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background-color: var(--primary-dark);
        }

        .btn.secondary {
            background-color: var(--surface-variant);
            color: var(--on-surface);
        }

        .btn.secondary:hover {
            background-color: var(--outline);
        }

        .btn.full-width {
            width: 100%;
        }

        .btn-group {
            display: flex;
            gap: 8px;
        }

        .btn-group .btn {
            flex: 1;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--outline);
            margin-bottom: 16px;
        }

        .tab {
            padding: 12px 16px;
            background: none;
            border: none;
            color: var(--on-surface);
            cursor: pointer;
            font-weight: 500;
            position: relative;
        }

        .tab:hover {
            background-color: var(--surface-variant);
        }

        .tab.active {
            color: var(--primary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .bone-item {
            background-color: var(--surface-variant);
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .bone-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .bone-name {
            font-weight: 500;
        }

        .bone-toggle {
            background: none;
            border: none;
            color: var(--on-surface);
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .bone-controls {
            display: grid;
            gap: 12px;
        }

        .transform-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .transform-label {
            min-width: 60px;
            font-size: 0.875rem;
        }

        .animation-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--outline);
            border-radius: 4px;
        }

        .animation-item {
            padding: 12px;
            border-bottom: 1px solid var(--outline);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .animation-item:hover {
            background-color: var(--surface-variant);
        }

        .animation-item:last-child {
            border-bottom: none;
        }

        .animation-item.active {
            background-color: rgba(98, 0, 234, 0.1);
        }

        .animation-name {
            font-weight: 500;
        }

        .animation-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--on-surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .icon-btn:hover {
            background-color: var(--surface-variant);
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .preset-item {
            background-color: var(--surface-variant);
            border-radius: 4px;
            padding: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
        }

        .preset-item:hover {
            background-color: var(--outline);
        }

        .preset-icon {
            font-size: 2rem;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .preset-name {
            font-weight: 500;
            font-size: 0.875rem;
        }

        .skin-preview {
            width: 100%;
            height: 160px;
            background-color: var(--surface-variant);
            border-radius: 4px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .skin-preview img {
            max-width: 100%;
            max-height: 100%;
            image-rendering: pixelated;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--surface);
            border-radius: 8px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .modal-title {
            font-weight: 500;
            font-size: 1.25rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--on-surface);
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .modal-body {
            margin-bottom: 16px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background-color: var(--surface);
            border-radius: 4px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            z-index: 2000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-icon {
            color: var(--primary);
        }

        .toast-message {
            flex: 1;
        }

        .color-picker {
            width: 100%;
            height: 40px;
            border: 1px solid var(--outline);
            border-radius: 4px;
            cursor: pointer;
        }

        .shortcuts-list {
            display: grid;
            gap: 8px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--outline);
        }

        .shortcut-key {
            background-color: var(--surface-variant);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.875rem;
        }

        .export-options {
            display: grid;
            gap: 12px;
        }

        .export-option {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: absolute;
                z-index: 50;
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .viewer-container {
                width: 100%;
            }

            .timeline-container {
                height: 150px;
            }

            .preset-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="app-title">
                <span class="material-icons">animation</span>
                <span>Minecraft Animation Editor Pro</span>
            </div>
            <div class="header-actions">
                <button class="header-btn secondary" id="newProjectBtn">
                    <span class="material-icons">add</span>
                    <span>Proyek Baru</span>
                </button>
                <button class="header-btn secondary" id="openProjectBtn">
                    <span class="material-icons">folder_open</span>
                    <span>Buka</span>
                </button>
                <button class="header-btn secondary" id="saveProjectBtn">
                    <span class="material-icons">save</span>
                    <span>Simpan</span>
                </button>
                <button class="header-btn" id="exportBtn">
                    <span class="material-icons">download</span>
                    <span>Export</span>
                </button>
            </div>
        </header>

        <div class="main-content">
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-section">
                    <div class="tabs">
                        <button class="tab active" data-tab="bones">Bones</button>
                        <button class="tab" data-tab="animations">Animasi</button>
                        <button class="tab" data-tab="presets">Preset</button>
                        <button class="tab" data-tab="skins">Skin</button>
                        <button class="tab" data-tab="settings">Pengaturan</button>
                    </div>

                    <div class="tab-content active" id="bones-tab">
                        <div class="control-group">
                            <div class="bone-item">
                                <div class="bone-header">
                                    <div class="bone-name">Head</div>
                                    <button class="bone-toggle">
                                        <span class="material-icons">expand_more</span>
                                    </button>
                                </div>
                                <div class="bone-controls">
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi X:</div>
                                        <input type="range" class="slider" id="head-rotation-x" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Y:</div>
                                        <input type="range" class="slider" id="head-rotation-y" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Z:</div>
                                        <input type="range" class="slider" id="head-rotation-z" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                </div>
                            </div>

                            <div class="bone-item">
                                <div class="bone-header">
                                    <div class="bone-name">Body</div>
                                    <button class="bone-toggle">
                                        <span class="material-icons">expand_more</span>
                                    </button>
                                </div>
                                <div class="bone-controls">
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi X:</div>
                                        <input type="range" class="slider" id="body-rotation-x" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Y:</div>
                                        <input type="range" class="slider" id="body-rotation-y" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Z:</div>
                                        <input type="range" class="slider" id="body-rotation-z" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                </div>
                            </div>

                            <div class="bone-item">
                                <div class="bone-header">
                                    <div class="bone-name">Left Arm</div>
                                    <button class="bone-toggle">
                                        <span class="material-icons">expand_more</span>
                                    </button>
                                </div>
                                <div class="bone-controls">
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi X:</div>
                                        <input type="range" class="slider" id="leftarm-rotation-x" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Y:</div>
                                        <input type="range" class="slider" id="leftarm-rotation-y" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Z:</div>
                                        <input type="range" class="slider" id="leftarm-rotation-z" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                </div>
                            </div>

                            <div class="bone-item">
                                <div class="bone-header">
                                    <div class="bone-name">Right Arm</div>
                                    <button class="bone-toggle">
                                        <span class="material-icons">expand_more</span>
                                    </button>
                                </div>
                                <div class="bone-controls">
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi X:</div>
                                        <input type="range" class="slider" id="rightarm-rotation-x" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Y:</div>
                                        <input type="range" class="slider" id="rightarm-rotation-y" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Z:</div>
                                        <input type="range" class="slider" id="rightarm-rotation-z" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                </div>
                            </div>

                            <div class="bone-item">
                                <div class="bone-header">
                                    <div class="bone-name">Left Leg</div>
                                    <button class="bone-toggle">
                                        <span class="material-icons">expand_more</span>
                                    </button>
                                </div>
                                <div class="bone-controls">
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi X:</div>
                                        <input type="range" class="slider" id="leftleg-rotation-x" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Y:</div>
                                        <input type="range" class="slider" id="leftleg-rotation-y" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Z:</div>
                                        <input type="range" class="slider" id="leftleg-rotation-z" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                </div>
                            </div>

                            <div class="bone-item">
                                <div class="bone-header">
                                    <div class="bone-name">Right Leg</div>
                                    <button class="bone-toggle">
                                        <span class="material-icons">expand_more</span>
                                    </button>
                                </div>
                                <div class="bone-controls">
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi X:</div>
                                        <input type="range" class="slider" id="rightleg-rotation-x" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Y:</div>
                                        <input type="range" class="slider" id="rightleg-rotation-y" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                    <div class="transform-control">
                                        <div class="transform-label">Rotasi Z:</div>
                                        <input type="range" class="slider" id="rightleg-rotation-z" min="-180" max="180" value="0">
                                        <div class="slider-value">0°</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="animations-tab">
                        <div class="control-group">
                            <div class="btn-group">
                                <button class="btn" id="addAnimationBtn">
                                    <span class="material-icons">add</span>
                                    <span>Tambah</span>
                                </button>
                                <button class="btn secondary" id="duplicateAnimationBtn">
                                    <span class="material-icons">content_copy</span>
                                    <span>Duplikat</span>
                                </button>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="animation-list" id="animationList">
                                <div class="animation-item active">
                                    <div class="animation-name">Walk</div>
                                    <div class="animation-actions">
                                        <button class="icon-btn">
                                            <span class="material-icons">edit</span>
                                        </button>
                                        <button class="icon-btn">
                                            <span class="material-icons">delete</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="animation-item">
                                    <div class="animation-name">Run</div>
                                    <div class="animation-actions">
                                        <button class="icon-btn">
                                            <span class="material-icons">edit</span>
                                        </button>
                                        <button class="icon-btn">
                                            <span class="material-icons">delete</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="animation-item">
                                    <div class="animation-name">Jump</div>
                                    <div class="animation-actions">
                                        <button class="icon-btn">
                                            <span class="material-icons">edit</span>
                                        </button>
                                        <button class="icon-btn">
                                            <span class="material-icons">delete</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Nama Animasi</label>
                            <input type="text" class="control-input" id="animationName" value="Walk">
                        </div>

                        <div class="control-group">
                            <label class="control-label">Durasi (detik)</label>
                            <div class="slider-container">
                                <input type="range" class="slider" id="animationDuration" min="0.1" max="10" step="0.1" value="1">
                                <div class="slider-value">1.0s</div>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Loop</label>
                            <div class="control-row">
                                <div class="control-col">
                                    <label class="control-label">
                                        <input type="checkbox" class="checkbox" id="animationLoop" checked>
                                        <span>Ulangi animasi</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Interpolasi</label>
                            <select class="control-input" id="animationInterpolation">
                                <option value="linear">Linear</option>
                                <option value="step">Step</option>
                                <option value="cubic-spline">Cubic Spline</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <div class="btn-group">
                                <button class="btn secondary" id="importAnimationBtn">
                                    <span class="material-icons">upload_file</span>
                                    <span>Import</span>
                                </button>
                                <button class="btn secondary" id="exportAnimationBtn">
                                    <span class="material-icons">download</span>
                                    <span>Export</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="presets-tab">
                        <div class="preset-grid">
                            <div class="preset-item" data-preset="walk">
                                <div class="preset-icon">
                                    <span class="material-icons">directions_walk</span>
                                </div>
                                <div class="preset-name">Jalan</div>
                            </div>
                            <div class="preset-item" data-preset="run">
                                <div class="preset-icon">
                                    <span class="material-icons">directions_run</span>
                                </div>
                                <div class="preset-name">Lari</div>
                            </div>
                            <div class="preset-item" data-preset="jump">
                                <div class="preset-icon">
                                    <span class="material-icons">airline_seat_legroom_extra</span>
                                </div>
                                <div class="preset-name">Lompat</div>
                            </div>
                            <div class="preset-item" data-preset="swim">
                                <div class="preset-icon">
                                    <span class="material-icons">pool</span>
                                </div>
                                <div class="preset-name">Berenang</div>
                            </div>
                            <div class="preset-item" data-preset="attack">
                                <div class="preset-icon">
                                    <span class="material-icons">sports_martial_arts</span>
                                </div>
                                <div class="preset-name">Serang</div>
                            </div>
                            <div class="preset-item" data-preset="wave">
                                <div class="preset-icon">
                                    <span class="material-icons">waving_hand</span>
                                </div>
                                <div class="preset-name">Melambai</div>
                            </div>
                            <div class="preset-item" data-preset="dance">
                                <div class="preset-icon">
                                    <span class="material-icons">music_note</span>
                                </div>
                                <div class="preset-name">Menari</div>
                            </div>
                            <div class="preset-item" data-preset="sit">
                                <div class="preset-icon">
                                    <span class="material-icons">chair</span>
                                </div>
                                <div class="preset-name">Duduk</div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="skins-tab">
                        <div class="control-group">
                            <div class="skin-preview">
                                <img src="https://picsum.photos/seed/minecraft-skin/64/64.jpg" alt="Skin Preview">
                            </div>
                            <button class="btn full-width" id="uploadSkinBtn">
                                <span class="material-icons">upload</span>
                                <span>Upload Skin</span>
                            </button>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Skin Library</label>
                            <div class="animation-list" id="skinList">
                                <div class="animation-item active">
                                    <div class="animation-name">Default</div>
                                    <div class="animation-actions">
                                        <button class="icon-btn">
                                            <span class="material-icons">check</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="animation-item">
                                    <div class="animation-name">Steve</div>
                                    <div class="animation-actions">
                                        <button class="icon-btn">
                                            <span class="material-icons">check</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="animation-item">
                                    <div class="animation-name">Alex</div>
                                    <div class="animation-actions">
                                        <button class="icon-btn">
                                            <span class="material-icons">check</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Model Type</label>
                            <select class="control-input" id="modelType">
                                <option value="classic">Classic</option>
                                <option value="slim">Slim</option>
                            </select>
                        </div>
                    </div>

                    <div class="tab-content" id="settings-tab">
                        <div class="control-group">
                            <label class="control-label">Kamera</label>
                            <select class="control-input" id="cameraType">
                                <option value="perspective">Perspektif</option>
                                <option value="orthographic">Ortografik</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Grid</label>
                            <label class="control-label">
                                <input type="checkbox" class="checkbox" id="showGrid" checked>
                                <span>Tampilkan Grid</span>
                            </label>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Snap</label>
                            <label class="control-label">
                                <input type="checkbox" class="checkbox" id="snapToGrid">
                                <span>Snap ke Grid</span>
                            </label>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Ukuran Grid</label>
                            <div class="slider-container">
                                <input type="range" class="slider" id="gridSize" min="1" max="20" value="10">
                                <div class="slider-value">10</div>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Background Color</label>
                            <input type="color" class="color-picker" id="backgroundColor" value="#0a0a0a">
                        </div>

                        <div class="control-group">
                            <label class="control-label">Lighting</label>
                            <select class="control-input" id="lightingType">
                                <option value="basic">Basic</option>
                                <option value="realistic">Realistis</option>
                                <option value="studio">Studio</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Keyboard Shortcuts</label>
                            <button class="btn secondary full-width" id="showShortcutsBtn">
                                <span class="material-icons">keyboard</span>
                                <span>Tampilkan Shortcut</span>
                            </button>
                        </div>
                    </div>
                </div>
            </aside>

            <div class="viewer-container">
                <div class="viewer-toolbar">
                    <div class="viewer-options">
                        <button class="viewer-btn active" data-view="perspective">
                            <span class="material-icons">3d_rotation</span>
                            <span>3D</span>
                        </button>
                        <button class="viewer-btn" data-view="front">
                            <span class="material-icons">arrow_forward</span>
                            <span>Depan</span>
                        </button>
                        <button class="viewer-btn" data-view="side">
                            <span class="material-icons">arrow_right_alt</span>
                            <span>Samping</span>
                        </button>
                        <button class="viewer-btn" data-view="top">
                            <span class="material-icons">arrow_downward</span>
                            <span>Atas</span>
                        </button>
                    </div>
                    <div class="viewer-options">
                        <button class="viewer-btn" id="resetCameraBtn">
                            <span class="material-icons">center_focus_strong</span>
                            <span>Reset Kamera</span>
                        </button>
                        <button class="viewer-btn" id="toggleWireframeBtn">
                            <span class="material-icons">grid_on</span>
                            <span>Wireframe</span>
                        </button>
                        <button class="viewer-btn" id="toggleSidebarBtn">
                            <span class="material-icons">menu</span>
                        </button>
                    </div>
                </div>

                <div class="canvas-container">
                    <canvas id="canvas"></canvas>
                </div>

                <div class="timeline-container">
                    <div class="timeline-header">
                        <div class="timeline-title">
                            <span class="material-icons">timeline</span>
                            <span>Timeline</span>
                        </div>
                        <div class="timeline-controls">
                            <button class="timeline-btn" id="prevFrameBtn">
                                <span class="material-icons">skip_previous</span>
                            </button>
                            <button class="timeline-btn active" id="playBtn">
                                <span class="material-icons">play_arrow</span>
                            </button>
                            <button class="timeline-btn" id="nextFrameBtn">
                                <span class="material-icons">skip_next</span>
                            </button>
                            <button class="timeline-btn" id="addKeyframeBtn">
                                <span class="material-icons">add_circle_outline</span>
                            </button>
                            <button class="timeline-btn" id="deleteKeyframeBtn">
                                <span class="material-icons">remove_circle_outline</span>
                            </button>
                        </div>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-tracks" id="timelineTracks">
                            <div class="timeline-track">
                                <div class="timeline-track-header">Head</div>
                                <div class="timeline-track-content">
                                    <div class="timeline-keyframe" style="left: 10%"></div>
                                    <div class="timeline-keyframe" style="left: 50%"></div>
                                    <div class="timeline-keyframe" style="left: 90%"></div>
                                </div>
                            </div>
                            <div class="timeline-track">
                                <div class="timeline-track-header">Body</div>
                                <div class="timeline-track-content">
                                    <div class="timeline-keyframe" style="left: 10%"></div>
                                    <div class="timeline-keyframe" style="left: 50%"></div>
                                    <div class="timeline-keyframe" style="left: 90%"></div>
                                </div>
                            </div>
                            <div class="timeline-track">
                                <div class="timeline-track-header">Left Arm</div>
                                <div class="timeline-track-content">
                                    <div class="timeline-keyframe" style="left: 10%"></div>
                                    <div class="timeline-keyframe" style="left: 50%"></div>
                                    <div class="timeline-keyframe" style="left: 90%"></div>
                                </div>
                            </div>
                            <div class="timeline-track">
                                <div class="timeline-track-header">Right Arm</div>
                                <div class="timeline-track-content">
                                    <div class="timeline-keyframe" style="left: 10%"></div>
                                    <div class="timeline-keyframe" style="left: 50%"></div>
                                    <div class="timeline-keyframe" style="left: 90%"></div>
                                </div>
                            </div>
                            <div class="timeline-track">
                                <div class="timeline-track-header">Left Leg</div>
                                <div class="timeline-track-content">
                                    <div class="timeline-keyframe" style="left: 10%"></div>
                                    <div class="timeline-keyframe" style="left: 50%"></div>
                                    <div class="timeline-keyframe" style="left: 90%"></div>
                                </div>
                            </div>
                            <div class="timeline-track">
                                <div class="timeline-track-header">Right Leg</div>
                                <div class="timeline-track-content">
                                    <div class="timeline-keyframe" style="left: 10%"></div>
                                    <div class="timeline-keyframe" style="left: 50%"></div>
                                    <div class="timeline-keyframe" style="left: 90%"></div>
                                </div>
                            </div>
                            <div class="timeline-playhead" id="playhead" style="left: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Export Animasi</div>
                <button class="modal-close" id="closeExportModal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <div class="export-option">
                        <input type="radio" name="exportFormat" id="jsonFormat" value="json" checked>
                        <label for="jsonFormat">JSON (Minecraft Bedrock)</label>
                    </div>
                    <div class="export-option">
                        <input type="radio" name="exportFormat" id="gifFormat" value="gif">
                        <label for="gifFormat">GIF</label>
                    </div>
                    <div class="export-option">
                        <input type="radio" name="exportFormat" id="mp4Format" value="mp4">
                        <label for="mp4Format">MP4 Video</label>
                    </div>
                    <div class="export-option">
                        <input type="radio" name="exportFormat" id="webmFormat" value="webm">
                        <label for="webmFormat">WebM Video</label>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">Nama File</label>
                    <input type="text" class="control-input" id="exportFileName" value="animation">
                </div>
                <div class="control-group">
                    <label class="control-label">Resolusi Video</label>
                    <select class="control-input" id="exportResolution">
                        <option value="480p">480p (854x480)</option>
                        <option value="720p" selected>720p (1280x720)</option>
                        <option value="1080p">1080p (1920x1080)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label class="control-label">Frame Rate</label>
                    <select class="control-input" id="exportFrameRate">
                        <option value="24">24 fps</option>
                        <option value="30" selected>30 fps</option>
                        <option value="60">60 fps</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" id="cancelExportBtn">Batal</button>
                <button class="btn" id="confirmExportBtn">Export</button>
            </div>
        </div>
    </div>

    <div class="modal" id="shortcutsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Keyboard Shortcuts</div>
                <button class="modal-close" id="closeShortcutsModal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <span>Play/Pause Animasi</span>
                        <span class="shortcut-key">Space</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Frame Berikutnya</span>
                        <span class="shortcut-key">→</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Frame Sebelumnya</span>
                        <span class="shortcut-key">←</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Tambah Keyframe</span>
                        <span class="shortcut-key">K</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Hapus Keyframe</span>
                        <span class="shortcut-key">D</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Reset Kamera</span>
                        <span class="shortcut-key">R</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Toggle Sidebar</span>
                        <span class="shortcut-key">S</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Toggle Grid</span>
                        <span class="shortcut-key">G</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Undo</span>
                        <span class="shortcut-key">Ctrl+Z</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Redo</span>
                        <span class="shortcut-key">Ctrl+Y</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Simpan Proyek</span>
                        <span class="shortcut-key">Ctrl+S</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Buka Proyek</span>
                        <span class="shortcut-key">Ctrl+O</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closeShortcutsFooterBtn">Tutup</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <span class="material-icons toast-icon">check_circle</span>
        <div class="toast-message" id="toastMessage">Operation completed successfully</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, model;
        let isPlaying = false;
        let currentFrame = 0;
        let totalFrames = 30;
        let animationData = [];
        let keyframes = {};
        let bones = {};
        let currentAnimation = "walk";
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let isWireframe = false;
        let showGrid = true;
        let gridHelper;
        let animationId;
        let undoStack = [];
        let redoStack = [];
        let currentCameraView = 'perspective';
        let animationSpeed = 1.0;
        let isLooping = true;
        let currentPreset = null;
        let skinTexture = null;
        let modelType = 'classic';
        let interpolationType = 'linear';
        let keyframeInterval = null;

        const boneNames = ['head', 'body', 'leftArm', 'rightArm', 'leftLeg', 'rightLeg'];

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);

            const canvas = document.getElementById('canvas');
            const container = canvas.parentElement;

            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 15, 35);
            camera.lookAt(0, 10, 0);

            renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 10);
            directionalLight.castShadow = true;
            directionalLight.shadow.camera.near = 0.1;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -20;
            directionalLight.shadow.camera.right = 20;
            directionalLight.shadow.camera.top = 20;
            directionalLight.shadow.camera.bottom = -20;
            scene.add(directionalLight);

            gridHelper = new THREE.GridHelper(50, 50, 0x444444, 0x222222);
            scene.add(gridHelper);

            createModel();
            setupEventListeners();
            setupBoneControls();
            setupTimeline();
            setupTabs();
            setupModal();
            setupKeyboardShortcuts();
            animate();

            window.addEventListener('resize', onWindowResize, false);
        }

        function createModel() {
            model = new THREE.Group();

            const defaultTexture = new THREE.TextureLoader().load('https://picsum.photos/seed/minecraft-skin/64/64.jpg');
            const material = new THREE.MeshLambertMaterial({ map: defaultTexture });

            bones.head = createCube(8, 8, 8, material);
            bones.head.position.y = 20;
            
            bones.body = createCube(8, 12, 4, material);
            bones.body.position.y = 12;
            
            bones.leftArm = createCube(4, 12, 4, material);
            bones.leftArm.position.set(-6, 14, 0);
            
            bones.rightArm = createCube(4, 12, 4, material);
            bones.rightArm.position.set(6, 14, 0);
            
            bones.leftLeg = createCube(4, 12, 4, material);
            bones.leftLeg.position.set(-2, 0, 0);
            
            bones.rightLeg = createCube(4, 12, 4, material);
            bones.rightLeg.position.set(2, 0, 0);

            for (let name in bones) {
                bones[name].userData.name = name;
                bones[name].userData.rotation = { x: 0, y: 0, z: 0 };
                bones[name].userData.position = { ...bones[name].position };
                bones[name].userData.initialPosition = { ...bones[name].position };
                bones[name].userData.initialRotation = { ...bones[name].rotation };
                model.add(bones[name]);
            }

            scene.add(model);
        }

        function createCube(w, h, d, material) {
            const geometry = new THREE.BoxGeometry(w, h, d);
            const mesh = new THREE.Mesh(geometry, material);
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            return mesh;
        }

        function setupEventListeners() {
            const canvas = document.getElementById('canvas');

            canvas.addEventListener('mousedown', onMouseDown);
            canvas.addEventListener('mousemove', onMouseMove);
            canvas.addEventListener('mouseup', onMouseUp);
            canvas.addEventListener('wheel', onMouseWheel);

            document.getElementById('playBtn').addEventListener('click', togglePlay);
            document.getElementById('prevFrameBtn').addEventListener('click', previousFrame);
            document.getElementById('nextFrameBtn').addEventListener('click', nextFrame);
            document.getElementById('addKeyframeBtn').addEventListener('click', addKeyframe);
            document.getElementById('deleteKeyframeBtn').addEventListener('click', deleteKeyframe);
            document.getElementById('resetCameraBtn').addEventListener('click', resetCamera);
            document.getElementById('toggleWireframeBtn').addEventListener('click', toggleWireframe);
            document.getElementById('toggleSidebarBtn').addEventListener('click', toggleSidebar);

            document.querySelectorAll('.viewer-btn[data-view]').forEach(btn => {
                btn.addEventListener('click', () => setCameraView(btn.dataset.view));
            });

            document.getElementById('showGrid').addEventListener('change', (e) => {
                showGrid = e.target.checked;
                gridHelper.visible = showGrid;
            });

            document.getElementById('backgroundColor').addEventListener('change', (e) => {
                scene.background = new THREE.Color(e.target.value);
            });

            document.getElementById('gridSize').addEventListener('input', (e) => {
                const size = parseInt(e.target.value);
                e.target.nextElementSibling.textContent = size;
                scene.remove(gridHelper);
                gridHelper = new THREE.GridHelper(50, size, 0x444444, 0x222222);
                gridHelper.visible = showGrid;
                scene.add(gridHelper);
            });

            document.getElementById('animationDuration').addEventListener('input', (e) => {
                const duration = parseFloat(e.target.value);
                e.target.nextElementSibling.textContent = duration.toFixed(1) + 's';
                totalFrames = Math.floor(duration * 30);
                updateTimeline();
            });

            document.getElementById('animationLoop').addEventListener('change', (e) => {
                isLooping = e.target.checked;
            });

            document.getElementById('animationInterpolation').addEventListener('change', (e) => {
                interpolationType = e.target.value;
            });

            document.getElementById('uploadSkinBtn').addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/png';
                input.onchange = (e) => loadSkin(e.target.files[0]);
                input.click();
            });

            document.getElementById('modelType').addEventListener('change', (e) => {
                modelType = e.target.value;
                updateModelType();
            });

            document.getElementById('lightingType').addEventListener('change', (e) => {
                updateLighting(e.target.value);
            });

            document.getElementById('exportBtn').addEventListener('click', () => {
                document.getElementById('exportModal').classList.add('active');
            });

            document.getElementById('closeExportModal').addEventListener('click', () => {
                document.getElementById('exportModal').classList.remove('active');
            });

            document.getElementById('cancelExportBtn').addEventListener('click', () => {
                document.getElementById('exportModal').classList.remove('active');
            });

            document.getElementById('confirmExportBtn').addEventListener('click', exportAnimation);

            document.getElementById('showShortcutsBtn').addEventListener('click', () => {
                document.getElementById('shortcutsModal').classList.add('active');
            });

            document.getElementById('closeShortcutsModal').addEventListener('click', () => {
                document.getElementById('shortcutsModal').classList.remove('active');
            });

            document.getElementById('closeShortcutsFooterBtn').addEventListener('click', () => {
                document.getElementById('shortcutsModal').classList.remove('active');
            });

            document.getElementById('newProjectBtn').addEventListener('click', newProject);
            document.getElementById('openProjectBtn').addEventListener('click', openProject);
            document.getElementById('saveProjectBtn').addEventListener('click', saveProject);

            document.getElementById('addAnimationBtn').addEventListener('click', addAnimation);
            document.getElementById('duplicateAnimationBtn').addEventListener('click', duplicateAnimation);
            document.getElementById('importAnimationBtn').addEventListener('click', importAnimation);
            document.getElementById('exportAnimationBtn').addEventListener('click', exportSingleAnimation);

            document.querySelectorAll('.preset-item').forEach(item => {
                item.addEventListener('click', () => applyPreset(item.dataset.preset));
            });

            document.querySelectorAll('.animation-item').forEach(item => {
                item.addEventListener('click', () => selectAnimation(item));
            });

            document.querySelectorAll('.bone-toggle').forEach(btn => {
                btn.addEventListener('click', () => toggleBoneControls(btn));
            });

            document.querySelectorAll('.skin-item').forEach(item => {
                item.addEventListener('click', () => selectSkin(item));
            });
        }

        function setupBoneControls() {
            boneNames.forEach(boneName => {
                ['x', 'y', 'z'].forEach(axis => {
                    const slider = document.getElementById(`${boneName.toLowerCase()}-rotation-${axis}`);
                    if (slider) {
                        slider.addEventListener('input', () => updateBone(boneName, axis, slider.value));
                    }
                });
            });
        }

        function setupTimeline() {
            updateTimeline();
        }

        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                });
            });
        }

        function setupModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

                switch (e.key) {
                    case ' ':
                        e.preventDefault();
                        togglePlay();
                        break;
                    case 'ArrowRight':
                        nextFrame();
                        break;
                    case 'ArrowLeft':
                        previousFrame();
                        break;
                    case 'k':
                    case 'K':
                        addKeyframe();
                        break;
                    case 'd':
                    case 'D':
                        deleteKeyframe();
                        break;
                    case 'r':
                    case 'R':
                        resetCamera();
                        break;
                    case 's':
                    case 'S':
                        if (e.ctrlKey) {
                            e.preventDefault();
                            saveProject();
                        } else {
                            toggleSidebar();
                        }
                        break;
                    case 'o':
                    case 'O':
                        if (e.ctrlKey) {
                            e.preventDefault();
                            openProject();
                        }
                        break;
                    case 'g':
                    case 'G':
                        document.getElementById('showGrid').click();
                        break;
                    case 'z':
                    case 'Z':
                        if (e.ctrlKey) {
                            e.preventDefault();
                            undo();
                        }
                        break;
                    case 'y':
                    case 'Y':
                        if (e.ctrlKey) {
                            e.preventDefault();
                            redo();
                        }
                        break;
                }
            });
        }

        function onMouseDown(event) {
            isDragging = true;
            previousMousePosition = { x: event.clientX, y: event.clientY };
        }

        function onMouseMove(event) {
            if (isDragging) {
                const deltaX = event.clientX - previousMousePosition.x;
                const deltaY = event.clientY - previousMousePosition.y;

                if (event.shiftKey) {
                    camera.position.x += deltaX * 0.1;
                    camera.position.y -= deltaY * 0.1;
                } else {
                    model.rotation.y += deltaX * 0.01;
                    camera.position.y += deltaY * 0.1;
                }

                previousMousePosition = { x: event.clientX, y: event.clientY };
            }
        }

        function onMouseUp() {
            isDragging = false;
        }

        function onMouseWheel(event) {
            const delta = event.deltaY * 0.01;
            camera.position.z += delta;
            camera.position.z = Math.max(10, Math.min(100, camera.position.z));
        }

        function onWindowResize() {
            const canvas = document.getElementById('canvas');
            const container = canvas.parentElement;
            
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function animate() {
            animationId = requestAnimationFrame(animate);
            
            if (isPlaying) {
                updateAnimation();
            }
            
            renderer.render(scene, camera);
        }

        function updateAnimation() {
            if (!keyframes || Object.keys(keyframes).length === 0) return;
            
            currentFrame = (currentFrame + 1) % totalFrames;
            if (currentFrame === 0 && !isLooping) {
                togglePlay();
                return;
            }
            
            updatePlayhead();
            applyKeyframes();
        }

        function updatePlayhead() {
            const playhead = document.getElementById('playhead');
            const percentage = (currentFrame / totalFrames) * 100;
            playhead.style.left = `${percentage}%`;
        }

        function applyKeyframes() {
            boneNames.forEach(boneName => {
                if (!keyframes[boneName]) return;
                
                const boneKeyframes = keyframes[boneName];
                const prevKeyframe = findPreviousKeyframe(boneKeyframes, currentFrame);
                const nextKeyframe = findNextKeyframe(boneKeyframes, currentFrame);
                
                if (prevKeyframe && nextKeyframe) {
                    const t = (currentFrame - prevKeyframe.frame) / (nextKeyframe.frame - prevKeyframe.frame);
                    const interpolatedRotation = interpolate(prevKeyframe.rotation, nextKeyframe.rotation, t);
                    
                    bones[boneName].rotation.x = THREE.MathUtils.degToRad(interpolatedRotation.x);
                    bones[boneName].rotation.y = THREE.MathUtils.degToRad(interpolatedRotation.y);
                    bones[boneName].rotation.z = THREE.MathUtils.degToRad(interpolatedRotation.z);
                } else if (prevKeyframe) {
                    bones[boneName].rotation.x = THREE.MathUtils.degToRad(prevKeyframe.rotation.x);
                    bones[boneName].rotation.y = THREE.MathUtils.degToRad(prevKeyframe.rotation.y);
                    bones[boneName].rotation.z = THREE.MathUtils.degToRad(prevKeyframe.rotation.z);
                }
            });
        }

        function findPreviousKeyframe(keyframes, frame) {
            let prev = null;
            for (const kf of keyframes) {
                if (kf.frame <= frame) {
                    prev = kf;
                } else {
                    break;
                }
            }
            return prev;
        }

        function findNextKeyframe(keyframes, frame) {
            for (const kf of keyframes) {
                if (kf.frame > frame) {
                    return kf;
                }
            }
            return null;
        }

        function interpolate(start, end, t) {
            switch (interpolationType) {
                case 'linear':
                    return {
                        x: start.x + (end.x - start.x) * t,
                        y: start.y + (end.y - start.y) * t,
                        z: start.z + (end.z - start.z) * t
                    };
                case 'step':
                    return t < 0.5 ? start : end;
                case 'cubic-spline':
                    const t2 = t * t;
                    const t3 = t2 * t;
                    return {
                        x: start.x + (end.x - start.x) * (3 * t2 - 2 * t3),
                        y: start.y + (end.y - start.y) * (3 * t2 - 2 * t3),
                        z: start.z + (end.z - start.z) * (3 * t2 - 2 * t3)
                    };
                default:
                    return start;
            }
        }

        function togglePlay() {
            isPlaying = !isPlaying;
            const playBtn = document.getElementById('playBtn');
            
            if (isPlaying) {
                playBtn.innerHTML = '<span class="material-icons">pause</span>';
            } else {
                playBtn.innerHTML = '<span class="material-icons">play_arrow</span>';
            }
        }

        function previousFrame() {
            if (isPlaying) togglePlay();
            currentFrame = (currentFrame - 1 + totalFrames) % totalFrames;
            updatePlayhead();
            applyKeyframes();
        }

        function nextFrame() {
            if (isPlaying) togglePlay();
            currentFrame = (currentFrame + 1) % totalFrames;
            updatePlayhead();
            applyKeyframes();
        }

        function addKeyframe() {
            boneNames.forEach(boneName => {
                if (!keyframes[boneName]) {
                    keyframes[boneName] = [];
                }
                
                const existingIndex = keyframes[boneName].findIndex(kf => kf.frame === currentFrame);
                
                if (existingIndex !== -1) {
                    keyframes[boneName][existingIndex].rotation = {
                        x: THREE.MathUtils.radToDeg(bones[boneName].rotation.x),
                        y: THREE.MathUtils.radToDeg(bones[boneName].rotation.y),
                        z: THREE.MathUtils.radToDeg(bones[boneName].rotation.z)
                    };
                } else {
                    keyframes[boneName].push({
                        frame: currentFrame,
                        rotation: {
                            x: THREE.MathUtils.radToDeg(bones[boneName].rotation.x),
                            y: THREE.MathUtils.radToDeg(bones[boneName].rotation.y),
                            z: THREE.MathUtils.radToDeg(bones[boneName].rotation.z)
                        }
                    });
                    
                    keyframes[boneName].sort((a, b) => a.frame - b.frame);
                }
            });
            
            updateTimeline();
            showToast('Keyframe ditambahkan');
        }

        function deleteKeyframe() {
            boneNames.forEach(boneName => {
                if (!keyframes[boneName]) return;
                
                keyframes[boneName] = keyframes[boneName].filter(kf => kf.frame !== currentFrame);
            });
            
            updateTimeline();
            showToast('Keyframe dihapus');
        }

        function updateTimeline() {
            boneNames.forEach(boneName => {
                const track = document.querySelector(`.timeline-track:has(.timeline-track-header:contains("${boneName}")) .timeline-track-content`);
                if (!track) return;
                
                track.innerHTML = '';
                
                if (keyframes[boneName]) {
                    keyframes[boneName].forEach(kf => {
                        const keyframe = document.createElement('div');
                        keyframe.className = 'timeline-keyframe';
                        keyframe.style.left = `${(kf.frame / totalFrames) * 100}%`;
                        keyframe.addEventListener('click', () => {
                            currentFrame = kf.frame;
                            updatePlayhead();
                            applyKeyframes();
                        });
                        track.appendChild(keyframe);
                    });
                }
            });
        }

        function updateBone(boneName, axis, value) {
            const bone = bones[boneName];
            const radians = THREE.MathUtils.degToRad(parseFloat(value));
            
            bone.rotation[axis] = radians;
            bone.userData.rotation[axis] = parseFloat(value);
            
            const valueDisplay = document.getElementById(`${boneName.toLowerCase()}-rotation-${axis}`).nextElementSibling;
            valueDisplay.textContent = `${value}°`;
        }

        function resetCamera() {
            camera.position.set(0, 15, 35);
            camera.lookAt(0, 10, 0);
            model.rotation.set(0, 0, 0);
            showToast('Kamera direset');
        }

        function setCameraView(view) {
            document.querySelectorAll('.viewer-btn[data-view]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.viewer-btn[data-view="${view}"]`).classList.add('active');
            
            currentCameraView = view;
            
            switch (view) {
                case 'perspective':
                    camera.position.set(0, 15, 35);
                    camera.lookAt(0, 10, 0);
                    break;
                case 'front':
                    camera.position.set(0, 10, 30);
                    camera.lookAt(0, 10, 0);
                    break;
                case 'side':
                    camera.position.set(30, 10, 0);
                    camera.lookAt(0, 10, 0);
                    break;
                case 'top':
                    camera.position.set(0, 40, 0);
                    camera.lookAt(0, 0, 0);
                    break;
            }
        }

        function toggleWireframe() {
            isWireframe = !isWireframe;
            
            for (let name in bones) {
                bones[name].material.wireframe = isWireframe;
            }
            
            const btn = document.getElementById('toggleWireframeBtn');
            if (isWireframe) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        function toggleBoneControls(btn) {
            const boneControls = btn.nextElementSibling;
            const icon = btn.querySelector('.material-icons');
            
            if (boneControls.style.display === 'none') {
                boneControls.style.display = 'grid';
                icon.textContent = 'expand_more';
            } else {
                boneControls.style.display = 'none';
                icon.textContent = 'expand_less';
            }
        }

        function loadSkin(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const texture = new THREE.TextureLoader().load(e.target.result);
                texture.magFilter = THREE.NearestFilter;
                texture.minFilter = THREE.NearestFilter;
                
                for (let name in bones) {
                    bones[name].material.map = texture;
                    bones[name].material.needsUpdate = true;
                }
                
                skinTexture = texture;
                document.querySelector('.skin-preview img').src = e.target.result;
                showToast('Skin berhasil dimuat');
            };
            reader.readAsDataURL(file);
        }

        function updateModelType() {
            const isSlim = modelType === 'slim';
            
            if (bones.leftArm && bones.rightArm) {
                const slimWidth = isSlim ? 3 : 4;
                
                bones.leftArm.geometry.dispose();
                bones.leftArm.geometry = new THREE.BoxGeometry(slimWidth, 12, 4);
                
                bones.rightArm.geometry.dispose();
                bones.rightArm.geometry = new THREE.BoxGeometry(slimWidth, 12, 4);
                
                const xPos = isSlim ? -5 : -6;
                bones.leftArm.position.x = xPos;
                bones.rightArm.position.x = -xPos;
            }
            
            showToast(`Model type diubah ke ${modelType}`);
        }

        function updateLighting(type) {
            scene.children = scene.children.filter(child => !(child instanceof THREE.Light));
            
            switch (type) {
                case 'basic':
                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
                    scene.add(ambientLight);
                    break;
                case 'realistic':
                    const sunLight = new THREE.DirectionalLight(0xffffff, 0.8);
                    sunLight.position.set(10, 20, 10);
                    sunLight.castShadow = true;
                    scene.add(sunLight);
                    
                    const skyLight = new THREE.HemisphereLight(0x87ceeb, 0x654321, 0.5);
                    scene.add(skyLight);
                    break;
                case 'studio':
                    const keyLight = new THREE.DirectionalLight(0xffffff, 0.8);
                    keyLight.position.set(10, 10, 10);
                    scene.add(keyLight);
                    
                    const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);
                    fillLight.position.set(-10, 0, -10);
                    scene.add(fillLight);
                    
                    const rimLight = new THREE.DirectionalLight(0xffffff, 0.4);
                    rimLight.position.set(0, 0, -10);
                    scene.add(rimLight);
                    break;
            }
            
            showToast(`Lighting diubah ke ${type}`);
        }

        function applyPreset(presetName) {
            currentPreset = presetName;
            
            switch (presetName) {
                case 'walk':
                    applyWalkPreset();
                    break;
                case 'run':
                    applyRunPreset();
                    break;
                case 'jump':
                    applyJumpPreset();
                    break;
                case 'swim':
                    applySwimPreset();
                    break;
                case 'attack':
                    applyAttackPreset();
                    break;
                case 'wave':
                    applyWavePreset();
                    break;
                case 'dance':
                    applyDancePreset();
                    break;
                case 'sit':
                    applySitPreset();
                    break;
            }
            
            showToast(`Preset ${presetName} diterapkan`);
        }

        function applyWalkPreset() {
            keyframes = {
                head: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: 5, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                body: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: 0, y: 0, z: 5 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                leftArm: [
                    { frame: 0, rotation: { x: 45, y: 0, z: 5 } },
                    { frame: 15, rotation: { x: 45, y: 0, z: -5 } },
                    { frame: 30, rotation: { x: 45, y: 0, z: 5 } }
                ],
                rightArm: [
                    { frame: 0, rotation: { x: 45, y: 0, z: -5 } },
                    { frame: 15, rotation: { x: 45, y: 0, z: 5 } },
                    { frame: 30, rotation: { x: 45, y: 0, z: -5 } }
                ],
                leftLeg: [
                    { frame: 0, rotation: { x: 20, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: -20, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 20, y: 0, z: 0 } }
                ],
                rightLeg: [
                    { frame: 0, rotation: { x: -20, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: 20, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: -20, y: 0, z: 0 } }
                ]
            };
            
            updateTimeline();
            document.getElementById('animationDuration').value = 1.0;
            document.getElementById('animationDuration').nextElementSibling.textContent = '1.0s';
            totalFrames = 30;
        }

        function applyRunPreset() {
            keyframes = {
                head: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 10, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: 0 } }
                ],
                body: [
                    { frame: 0, rotation: { x: 10, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: -10, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 10, y: 0, z: 0 } }
                ],
                leftArm: [
                    { frame: 0, rotation: { x: 90, y: 0, z: 10 } },
                    { frame: 10, rotation: { x: 90, y: 0, z: -10 } },
                    { frame: 20, rotation: { x: 90, y: 0, z: 10 } }
                ],
                rightArm: [
                    { frame: 0, rotation: { x: 90, y: 0, z: -10 } },
                    { frame: 10, rotation: { x: 90, y: 0, z: 10 } },
                    { frame: 20, rotation: { x: 90, y: 0, z: -10 } }
                ],
                leftLeg: [
                    { frame: 0, rotation: { x: 45, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: -45, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 45, y: 0, z: 0 } }
                ],
                rightLeg: [
                    { frame: 0, rotation: { x: -45, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 45, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: -45, y: 0, z: 0 } }
                ]
            };
            
            updateTimeline();
            document.getElementById('animationDuration').value = 0.7;
            document.getElementById('animationDuration').nextElementSibling.textContent = '0.7s';
            totalFrames = 21;
        }

        function applyJumpPreset() {
            keyframes = {
                head: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 5, rotation: { x: -10, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 10, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                body: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 5, rotation: { x: -20, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 20, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                leftArm: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 180, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 180, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                rightArm: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 180, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 180, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                leftLeg: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: -30, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: -30, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                rightLeg: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: -30, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: -30, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ]
            };
            
            updateTimeline();
            document.getElementById('animationDuration').value = 1.0;
            document.getElementById('animationDuration').nextElementSibling.textContent = '1.0s';
            totalFrames = 30;
        }

        function applySwimPreset() {
            keyframes = {
                head: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: 10, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                body: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: 0, y: 0, z: 20 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                leftArm: [
                    { frame: 0, rotation: { x: 90, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: 90, y: 0, z: 45 } },
                    { frame: 30, rotation: { x: 90, y: 0, z: 0 } }
                ],
                rightArm: [
                    { frame: 0, rotation: { x: 90, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: 90, y: 0, z: -45 } },
                    { frame: 30, rotation: { x: 90, y: 0, z: 0 } }
                ],
                leftLeg: [
                    { frame: 0, rotation: { x: 20, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: -20, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 20, y: 0, z: 0 } }
                ],
                rightLeg: [
                    { frame: 0, rotation: { x: -20, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: 20, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: -20, y: 0, z: 0 } }
                ]
            };
            
            updateTimeline();
            document.getElementById('animationDuration').value = 1.0;
            document.getElementById('animationDuration').nextElementSibling.textContent = '1.0s';
            totalFrames = 30;
        }

        function applyAttackPreset() {
            keyframes = {
                head: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: 0 } }
                ],
                body: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: 0 } }
                ],
                leftArm: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: -90 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: 0 } }
                ],
                rightArm: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: 90 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: 0 } }
                ],
                leftLeg: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: 0 } }
                ],
                rightLeg: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: 0 } }
                ]
            };
            
            updateTimeline();
            document.getElementById('animationDuration').value = 0.7;
            document.getElementById('animationDuration').nextElementSibling.textContent = '0.7s';
            totalFrames = 21;
        }

        function applyWavePreset() {
            keyframes = {
                head: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: 0, y: 10, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                body: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 15, rotation: { x: 0, y: 5, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                leftArm: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 180, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 180, y: 0, z: 45 } },
                    { frame: 30, rotation: { x: 180, y: 0, z: 0 } }
                ],
                rightArm: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                leftLeg: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                rightLeg: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ]
            };
            
            updateTimeline();
            document.getElementById('animationDuration').value = 1.0;
            document.getElementById('animationDuration').nextElementSibling.textContent = '1.0s';
            totalFrames = 30;
        }

        function applyDancePreset() {
            keyframes = {
                head: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: 10 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: -10 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                body: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: 5 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: -5 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                leftArm: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: 90 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: -90 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                rightArm: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: -90 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: 90 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                leftLeg: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: 10 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: -10 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ],
                rightLeg: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 0, y: 0, z: -10 } },
                    { frame: 20, rotation: { x: 0, y: 0, z: 10 } },
                    { frame: 30, rotation: { x: 0, y: 0, z: 0 } }
                ]
            };
            
            updateTimeline();
            document.getElementById('animationDuration').value = 1.0;
            document.getElementById('animationDuration').nextElementSibling.textContent = '1.0s';
            totalFrames = 30;
        }

        function applySitPreset() {
            keyframes = {
                head: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 10, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 10, y: 0, z: 0 } }
                ],
                body: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 45, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: 45, y: 0, z: 0 } }
                ],
                leftArm: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 45, y: 0, z: 10 } },
                    { frame: 20, rotation: { x: 45, y: 0, z: 10 } }
                ],
                rightArm: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: 45, y: 0, z: -10 } },
                    { frame: 20, rotation: { x: 45, y: 0, z: -10 } }
                ],
                leftLeg: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: -90, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: -90, y: 0, z: 0 } }
                ],
                rightLeg: [
                    { frame: 0, rotation: { x: 0, y: 0, z: 0 } },
                    { frame: 10, rotation: { x: -90, y: 0, z: 0 } },
                    { frame: 20, rotation: { x: -90, y: 0, z: 0 } }
                ]
            };
            
            updateTimeline();
            document.getElementById('animationDuration').value = 0.7;
            document.getElementById('animationDuration').nextElementSibling.textContent = '0.7s';
            totalFrames = 21;
        }

        function selectAnimation(item) {
            document.querySelectorAll('.animation-item').forEach(i => i.classList.remove('active'));
            item.classList.add('active');
            
            const animationName = item.querySelector('.animation-name').textContent;
            document.getElementById('animationName').value = animationName;
            currentAnimation = animationName.toLowerCase();
            
            loadAnimation(currentAnimation);
            showToast(`Animasi ${animationName} dipilih`);
        }

        function loadAnimation(animationName) {
            keyframes = {};
            currentFrame = 0;
            updatePlayhead();
            updateTimeline();
            
            if (animationName === 'walk') {
                applyWalkPreset();
            } else if (animationName === 'run') {
                applyRunPreset();
            } else if (animationName === 'jump') {
                applyJumpPreset();
            }
        }

        function selectSkin(item) {
            document.querySelectorAll('.skin-item').forEach(i => i.classList.remove('active'));
            item.classList.add('active');
            
            const skinName = item.querySelector('.skin-name').textContent;
            showToast(`Skin ${skinName} dipilih`);
        }

        function addAnimation() {
            const name = prompt('Nama animasi baru:');
            if (!name) return;
            
            const animationList = document.getElementById('animationList');
            const newItem = document.createElement('div');
            newItem.className = 'animation-item';
            newItem.innerHTML = `
                <div class="animation-name">${name}</div>
                <div class="animation-actions">
                    <button class="icon-btn">
                        <span class="material-icons">edit</span>
                    </button>
                    <button class="icon-btn">
                        <span class="material-icons">delete</span>
                    </button>
                </div>
            `;
            
            newItem.addEventListener('click', () => selectAnimation(newItem));
            animationList.appendChild(newItem);
            
            showToast(`Animasi ${name} ditambahkan`);
        }

        function duplicateAnimation() {
            const activeItem = document.querySelector('.animation-item.active');
            if (!activeItem) {
                showToast('Pilih animasi terlebih dahulu');
                return;
            }
            
            const originalName = activeItem.querySelector('.animation-name').textContent;
            const newName = prompt(`Nama untuk duplikat ${originalName}:`, `${originalName}_copy`);
            if (!newName) return;
            
            const animationList = document.getElementById('animationList');
            const newItem = document.createElement('div');
            newItem.className = 'animation-item';
            newItem.innerHTML = `
                <div class="animation-name">${newName}</div>
                <div class="animation-actions">
                    <button class="icon-btn">
                        <span class="material-icons">edit</span>
                    </button>
                    <button class="icon-btn">
                        <span class="material-icons">delete</span>
                    </button>
                </div>
            `;
            
            newItem.addEventListener('click', () => selectAnimation(newItem));
            animationList.appendChild(newItem);
            
            showToast(`Animasi ${newName} diduplikat`);
        }

        function importAnimation() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.animations) {
                            Object.keys(data.animations).forEach(name => {
                                const animation = data.animations[name];
                                const animationList = document.getElementById('animationList');
                                
                                const newItem = document.createElement('div');
                                newItem.className = 'animation-item';
                                newItem.innerHTML = `
                                    <div class="animation-name">${name}</div>
                                    <div class="animation-actions">
                                        <button class="icon-btn">
                                            <span class="material-icons">edit</span>
                                        </button>
                                        <button class="icon-btn">
                                            <span class="material-icons">delete</span>
                                        </button>
                                    </div>
                                `;
                                
                                newItem.addEventListener('click', () => selectAnimation(newItem));
                                animationList.appendChild(newItem);
                            });
                            
                            showToast('Animasi berhasil diimpor');
                        } else {
                            showToast('Format file tidak valid');
                        }
                    } catch (error) {
                        showToast('Error membaca file animasi');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

                function exportSingleAnimation() {
            const activeItem = document.querySelector('.animation-item.active');
            if (!activeItem) {
                showToast('Pilih animasi terlebih dahulu');
                return;
            }
            
            const animationName = activeItem.querySelector('.animation-name').textContent;
            const animationData = {
                format_version: "1.8.0",
                animations: {
                    [`animation.${animationName.toLowerCase()}`]: {
                        animation_length: totalFrames / 30,
                        loop: isLooping,
                        bones: {}
                    }
                }
            };
            
            boneNames.forEach(boneName => {
                animationData.animations[`animation.${animationName.toLowerCase()}`].bones[boneName] = {
                    rotation: {}
                };
                
                if (keyframes[boneName]) {
                    keyframes[boneName].forEach(kf => {
                        const time = (kf.frame / totalFrames) * (totalFrames / 30);
                        
                        if (!animationData.animations[`animation.${animationName.toLowerCase()}`].bones[boneName].rotation[time]) {
                            animationData.animations[`animation.${animationName.toLowerCase()}`].bones[boneName].rotation[time] = [];
                        }
                        
                        animationData.animations[`animation.${animationName.toLowerCase()}`].bones[boneName].rotation[time] = [
                            THREE.MathUtils.degToRad(kf.rotation.x),
                            THREE.MathUtils.degToRad(kf.rotation.y),
                            THREE.MathUtils.degToRad(kf.rotation.z)
                        ];
                    });
                }
            });
            
            const dataStr = JSON.stringify(animationData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `${animationName}.json`;
            link.click();
            
            showToast(`Animasi ${animationName} diexport`);
        }

        function exportAnimation() {
            const format = document.querySelector('input[name="exportFormat"]:checked').value;
            const fileName = document.getElementById('exportFileName').value;
            
            switch (format) {
                case 'json':
                    exportJSON(fileName);
                    break;
                case 'gif':
                    exportGIF(fileName);
                    break;
                case 'mp4':
                case 'webm':
                    exportVideo(fileName, format);
                    break;
            }
            
            document.getElementById('exportModal').classList.remove('active');
        }

        function exportJSON(fileName) {
            const projectData = {
                metadata: {
                    name: fileName,
                    version: "1.0.0",
                    created: new Date().toISOString(),
                    author: "Minecraft Animation Editor Pro"
                },
                animations: {},
                settings: {
                    modelType: modelType,
                    interpolation: interpolationType,
                    loop: isLooping
                }
            };
            
            document.querySelectorAll('.animation-item').forEach(item => {
                const animName = item.querySelector('.animation-name').textContent;
                projectData.animations[animName] = {
                    duration: totalFrames / 30,
                    loop: isLooping,
                    keyframes: keyframes
                };
            });
            
            const dataStr = JSON.stringify(projectData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `${fileName}.json`;
            link.click();
            
            showToast(`Proyek ${fileName} diexport sebagai JSON`);
        }

        function exportGIF(fileName) {
            showToast('Membuat GIF... (Fitur dalam pengembangan)');
            
            // Simulasi proses export GIF
            setTimeout(() => {
                showToast(`GIF ${fileName}.gif berhasil dibuat`);
            }, 2000);
        }

        function exportVideo(fileName, format) {
            showToast(`Membuat video ${format.toUpperCase()}... (Fitur dalam pengembangan)`);
            
            // Simulasi proses export video
            setTimeout(() => {
                showToast(`Video ${fileName}.${format} berhasil dibuat`);
            }, 3000);
        }

        function newProject() {
            if (confirm('Buat proyek baru? Semua perubahan yang belum disimpan akan hilang.')) {
                keyframes = {};
                currentFrame = 0;
                currentAnimation = "walk";
                isPlaying = false;
                
                document.getElementById('playBtn').innerHTML = '<span class="material-icons">play_arrow</span>';
                document.getElementById('animationName').value = "Walk";
                document.getElementById('animationDuration').value = 1.0;
                document.getElementById('animationDuration').nextElementSibling.textContent = '1.0s';
                document.getElementById('animationLoop').checked = true;
                document.getElementById('animationInterpolation').value = 'linear';
                
                boneNames.forEach(boneName => {
                    ['x', 'y', 'z'].forEach(axis => {
                        const slider = document.getElementById(`${boneName.toLowerCase()}-rotation-${axis}`);
                        if (slider) {
                            slider.value = 0;
                            slider.nextElementSibling.textContent = '0°';
                        }
                    });
                    
                    if (bones[boneName]) {
                        bones[boneName].rotation.set(0, 0, 0);
                        bones[boneName].userData.rotation = { x: 0, y: 0, z: 0 };
                    }
                });
                
                updateTimeline();
                updatePlayhead();
                resetCamera();
                
                showToast('Proyek baru dibuat');
            }
        }

        function openProject() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const projectData = JSON.parse(event.target.result);
                        loadProject(projectData);
                        showToast('Proyek berhasil dibuka');
                    } catch (error) {
                        showToast('Error membaca file proyek');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function loadProject(projectData) {
            if (projectData.animations) {
                const animationList = document.getElementById('animationList');
                animationList.innerHTML = '';
                
                Object.keys(projectData.animations).forEach((animName, index) => {
                    const animation = projectData.animations[animName];
                    const newItem = document.createElement('div');
                    newItem.className = `animation-item ${index === 0 ? 'active' : ''}`;
                    newItem.innerHTML = `
                        <div class="animation-name">${animName}</div>
                        <div class="animation-actions">
                            <button class="icon-btn">
                                <span class="material-icons">edit</span>
                            </button>
                            <button class="icon-btn">
                                <span class="material-icons">delete</span>
                            </button>
                        </div>
                    `;
                    
                    newItem.addEventListener('click', () => selectAnimation(newItem));
                    animationList.appendChild(newItem);
                    
                    if (index === 0) {
                        document.getElementById('animationName').value = animName;
                        currentAnimation = animName.toLowerCase();
                        
                        if (animation.keyframes) {
                            keyframes = animation.keyframes;
                            totalFrames = Math.floor(animation.duration * 30);
                            document.getElementById('animationDuration').value = animation.duration;
                            document.getElementById('animationDuration').nextElementSibling.textContent = animation.duration.toFixed(1) + 's';
                        }
                    }
                });
                
                if (projectData.settings) {
                    if (projectData.settings.modelType) {
                        modelType = projectData.settings.modelType;
                        document.getElementById('modelType').value = modelType;
                        updateModelType();
                    }
                    
                    if (projectData.settings.interpolation) {
                        interpolationType = projectData.settings.interpolation;
                        document.getElementById('animationInterpolation').value = interpolationType;
                    }
                    
                    if (projectData.settings.loop !== undefined) {
                        isLooping = projectData.settings.loop;
                        document.getElementById('animationLoop').checked = isLooping;
                    }
                }
                
                updateTimeline();
                currentFrame = 0;
                updatePlayhead();
                applyKeyframes();
            }
        }

        function saveProject() {
            const projectName = prompt('Nama proyek:', 'MyAnimationProject');
            if (!projectName) return;
            
            const projectData = {
                metadata: {
                    name: projectName,
                    version: "1.0.0",
                    created: new Date().toISOString(),
                    author: "Minecraft Animation Editor Pro"
                },
                animations: {},
                settings: {
                    modelType: modelType,
                    interpolation: interpolationType,
                    loop: isLooping
                }
            };
            
            document.querySelectorAll('.animation-item').forEach(item => {
                const animName = item.querySelector('.animation-name').textContent;
                projectData.animations[animName] = {
                    duration: totalFrames / 30,
                    loop: isLooping,
                    keyframes: keyframes
                };
            });
            
            const dataStr = JSON.stringify(projectData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `${projectName}.json`;
            link.click();
            
            showToast(`Proyek ${projectName} disimpan`);
        }

        function undo() {
            if (undoStack.length > 0) {
                const state = undoStack.pop();
                redoStack.push({
                    keyframes: JSON.parse(JSON.stringify(keyframes)),
                    currentFrame: currentFrame
                });
                
                keyframes = state.keyframes;
                currentFrame = state.currentFrame;
                
                updateTimeline();
                updatePlayhead();
                applyKeyframes();
                
                showToast('Undo berhasil');
            } else {
                showToast('Tidak ada aksi untuk di-undo');
            }
        }

        function redo() {
            if (redoStack.length > 0) {
                const state = redoStack.pop();
                undoStack.push({
                    keyframes: JSON.parse(JSON.stringify(keyframes)),
                    currentFrame: currentFrame
                });
                
                keyframes = state.keyframes;
                currentFrame = state.currentFrame;
                
                updateTimeline();
                updatePlayhead();
                applyKeyframes();
                
                showToast('Redo berhasil');
            } else {
                showToast('Tidak ada aksi untuk di-redo');
            }
        }

        function saveState() {
            undoStack.push({
                keyframes: JSON.parse(JSON.stringify(keyframes)),
                currentFrame: currentFrame
            });
            
            // Batasi stack undo maksimal 50 state
            if (undoStack.length > 50) {
                undoStack.shift();
            }
            
            // Reset redo stack ketika ada aksi baru
            redoStack = [];
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Inisialisasi aplikasi
        document.addEventListener('DOMContentLoaded', () => {
            init();
            
            // Simpan state awal
            saveState();
            
            // Setup event listener untuk bone controls untuk menyimpan state
            boneNames.forEach(boneName => {
                ['x', 'y', 'z'].forEach(axis => {
                    const slider = document.getElementById(`${boneName.toLowerCase()}-rotation-${axis}`);
                    if (slider) {
                        slider.addEventListener('change', () => {
                            saveState();
                        });
                    }
                });
            });
            
            showToast('Minecraft Animation Editor Pro siap digunakan!');
        });
    </script>
</body>
</html>
